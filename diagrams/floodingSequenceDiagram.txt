title Flooding

participant Player
participant FloodDeck
participant GameLogic
participant Tile
participant Board
participant User Interface

Player->GameLogic:numFloodCardsToDraw
activate GameLogic
GameLogic->>Player:numCards
deactivate GameLogic
loop numCards
  Player->FloodDeck:draw
  activate FloodDeck
  FloodDeck->FloodDeck:draw
  FloodDeck->GameLogic:tileFlooded
  activate GameLogic
  GameLogic->Board:getCoordinates
  activate Board
  Board->>GameLogic:tileCoordinates
  deactivate Board
  GameLogic->Board:getState
  activate Board
  Board->>GameLogic:tileState
  deactivate Board
  alt Tile sank
  GameLogic->User Interface:tileSunk
  else Tile flooded
  GameLogic->User Interface:tileFlooded
  end
  GameLogic->>FloodDeck:tileState
  deactivate GameLogic
  opt tileState != sunk
    FloodDeck->FloodDeck:discard
  end
  FloodDeck->Board:flood
  activate Board
  Board->Tile:flood
  activate Tile
  opt tile sank
    Tile->GameLogic:tileSank
    activate GameLogic
    alt Fools Landing Sank
      GameLogic->User Interface:gameOverFoolsLandingSank
    else Both locations of uncaptured treasure sank
      GameLogic->User Interface:gameOverCannotCaptureTreasure
    else Tile with player sank
      GameLogic->Player:tileIsSinking
      activate Player
      Player->Player:getMoveOptions
      opt No move options
        Player->User Interface:gameOverNoMoveOptions
      end
      deactivate Player
    end
    deactivate GameLogic
  end
  deactivate Tile
  Board->>FloodDeck:tileState
  deactivate Board
  FloodDeck->>Player:floodedLocation
  deactivate FloodDeck
end
